TARGET	= gfarmfs
SRCS	= gfarmfs.c
OBJS	= gfarmfs.o

CC = @CC@
DEFS = @DEFS@

CPPFLAGS = -g -Wall -O2 @CPPFLAGS@ -DFUSE_USE_VERSION=22 -D_FILE_OFFSET_BITS=64 @symlinkmode@ @linkiscopymode@

LDFLAGS = @LDFLAGS@
LIBS = @LIBS@

VER     = $(TARGET)-fuse-`date +%Y%m%d`
FILES   = $(SRCS) Makefile.in configure.in configure README

all: $(TARGET)

$(TARGET): $(OBJS)
	$(CC) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

.c.o:
	$(CC) $(CPPFLAGS) -c -o $@ $<

$(OBJS): Makefile

clean:
	$(RM) $(OBJS) $(TARGET)

tar:
	@echo $(VER) > .package
	@$(RM) -r `cat .package`
	@mkdir `cat .package`
	cp --parents $(FILES) `cat .package`
	tar cvf - `cat .package` | gzip -9 > `cat .package`.tar.gz
	@$(RM) -r `cat .package` .package
