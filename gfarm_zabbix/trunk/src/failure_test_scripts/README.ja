[This is written in Japanese, please look at README.en for English version.]

                 障害発生テストケース実行スクリプト

● 障害発生テストケース実行スクリプトについて
=============================================

障害発生テストケース実行スクリプトはgfservice, gfservice-agent を利用し
Gfarm 及び Gfarm 監視に関する障害を意図的に発生させるスクリプトです。

● 障害発生テストケースの実行環境
=================================

本ディレクトリに置かれている障害発生テストケース実行スクリプトは、以下
の環境で実行することを想定しています。

  - 全ホスト対象の条件
    - Gfarm クライアントノードとして設定済みであること
    - Zabbix エージェントが導入・設定済みであること
    - gfservice-agent がインストール済みであること
    - zabbix ユーザが NOPASSWORD で tty なし sudo が実行可能なこと
  - 障害発生テストケース実行ホスト対象の条件
    - Zabbix サーバが導入・設定済みであること
    - gfservice がインストール済みであること
    - zabbix ユーザが全ホストにパスフレーズなし ssh ログイン可能なこと
    - 障害発生・復旧時に zabbix ユーザにメール通知されること

障害発生テストケースの実行には以下の9台のホストが必要です。

  - メタデータノード 3台 (マスター 1台、スレーブ 2台)
  - ファイルシステムノード 2台
  - クライアントノード 2台
  - Zabbix サーバ 2台 (マスターノード 1台、子ノード 1台)

● 障害発生テストケースを実行する際の準備
=========================================

障害発生テストケース実行スクリプトを実行する際は、事前にホストのIPアド
レスなどの詳細な情報を gfservice の設定ファイルgfservice.conf に反映し
てください。

また、一部のテストケースは、malloc というプログラムを使用します。この
malloc は、本ディレクトリにある malloc.c という C 言語プログラムをコン
パイルして作成する必要があります。コンパイルを行うには、C コンパイラや
make コマンドをインストールし、Makefile を必要に応じて適宜編集した上で、

    $ make

を実行してください。

● 障害発生テストケースの実行方法
=================================

・単体のテストケースを実行する場合

  zabbix ユーザで障害発生テストケーススクリプトを実行してください。テス
  トケース ID FT1-2-1-1 を実行する場合は以下のようになります。

    $ ./FT1-2-1-1_disk_exhausted

・全テストケースを実行する場合

  zabbix ユーザで以下のように全テストケース実行スクリプトを実行してくだ
  さい。

    $ ./FT-run-all
 
● ファイル一覧
===============

    README.ja                  : 本ファイル
    Makefile                   : malloc.c コンパイル用 Makefile
    gfservice.conf             : gfservice 設定ファイル サンプル
    FT-run-all                 : 全テストケース実行スクリプト
    FT-common                  : テストケーススクリプト共通関数
    FT-config                  : テスト環境の全ホストの Gfarm を自動設定
                                 するスクリプト
    cpu-stress                 : CPU 負荷を発生させるスクリプト
    create-random-file         : 任意サイズのファイルを生成するスクリプト
    FT-set-journal-size        : ジャーナルファイルサイズ変更スクリプト
    FT-unconfig                : テスト環境の全ホストの Gfarm 設定を自動
                                 削除するスクリプト
    malloc.c                   : メモリを消費させるプログラム
    mbox-search                : 通知メール検出スクリプト

それ以外の、ファイル名が "FTx-x-x-x_" (各 x は整数) で始まるファイル
(例: FT1-2-2-1_db_down) は、当該テストケースを実行するためのスクリプト
です。各テストケースがどのようなテストを行っているかは、

    doc/test_spec_and_result.xls

を参照してください。
